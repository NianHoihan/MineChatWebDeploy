@import "tailwindcss";
@plugin "@tailwindcss/typography";

:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --card: 0 0% 100%;
  --card-foreground: 222.2 84% 4.9%;
  --popover: 0 0% 100%;
  --popover-foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
  --secondary: 210 40% 96%;
  --secondary-foreground: 222.2 84% 4.9%;
  --muted: 210 40% 96%;
  --muted-foreground: 215.4 16.3% 46.9%;
  --accent: 210 40% 96%;
  --accent-foreground: 222.2 84% 4.9%;
  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;
  --border: 214.3 31.8% 91.4%;
  --input: 214.3 31.8% 91.4%;
  --ring: 221.2 83.2% 53.3%;
  --radius: 0.5rem;
}

.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --card: 222.2 84% 4.9%;
  --card-foreground: 210 40% 98%;
  --popover: 222.2 84% 4.9%;
  --popover-foreground: 210 40% 98%;
  --primary: 217.2 91.2% 59.8%;
  --primary-foreground: 222.2 84% 4.9%;
  --secondary: 217.2 32.6% 17.5%;
  --secondary-foreground: 210 40% 98%;
  --muted: 217.2 32.6% 17.5%;
  --muted-foreground: 215 20.2% 65.1%;
  --accent: 217.2 32.6% 17.5%;
  --accent-foreground: 210 40% 98%;
  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 210 40% 98%;
  --border: 217.2 32.6% 17.5%;
  --input: 217.2 32.6% 17.5%;
  --ring: 224.3 76.3% 94.1%;
}

* {
  border-color: hsl(var(--border));
}

body {
  background-color: hsl(var(--background));
  color: hsl(var(--foreground));
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

/* 自定义滚动条样式 */
.scrollbar-thin {
  scrollbar-width: thin;
  scrollbar-color: rgb(75 85 99) transparent;
}

.scrollbar-thin::-webkit-scrollbar {
  width: 6px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  background: transparent;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  background: rgb(75 85 99);
  border-radius: 3px;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background: rgb(55 65 81);
}

/* 确保正确的布局 */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overscroll-behavior: none; /* 防止下拉刷新 */
}

#__next {
  height: 100%;
}

/* iOS Safari 视口高度修正脚本支持 */
@media (max-width: 768px) {
  /* 当键盘弹出时避免布局跳动 */
  .keyboard-adjust {
    transition: none;
  }
  
  /* 键盘弹出时推动内容上移 */
  .keyboard-open .messages-container {
    padding-bottom: 0;
  }
  
  .keyboard-open .input-area {
    position: fixed;
    bottom: 0;
  }
}

/* ===== 移动端适配样式 ===== */

/* 桌面端侧边栏 - 移动端隐藏 */
.desktop-sidebar {
  display: block;
}

@media (max-width: 768px) {
  .desktop-sidebar {
    display: none !important;
  }
}

/* 移动端抽屉 - 只在移动端显示 */
.mobile-drawer {
  display: none;
}

@media (max-width: 768px) {
  .mobile-drawer {
    display: block !important;
  }
}

/* CSS 变量：safe area 支持 */
:root {
  --safe-area-inset-top: env(safe-area-inset-top, 0);
  --safe-area-inset-right: env(safe-area-inset-right, 0);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0);
  --safe-area-inset-left: env(safe-area-inset-left, 0);
  
  /* iOS 视口高度修正 */
  --vh: 1vh;
  --mobile-vh: 100vh;
}

/* 移动端视口高度处理 */
@media (max-width: 768px) {
  :root {
    --mobile-vh: calc(var(--vh, 1vh) * 100);
  }
  
  .chat-layout {
    height: var(--mobile-vh);
    min-height: var(--mobile-vh);
  }
}

/* 移动端头部样式 - 只在移动端显示 */
.mobile-header {
  display: none;
  padding-top: max(0.75rem, var(--safe-area-inset-top));
  padding-left: max(1rem, var(--safe-area-inset-left));
  padding-right: max(1rem, var(--safe-area-inset-right));
}

@media (max-width: 768px) {
  .mobile-header {
    display: flex !important;
  }
}

/* 移动端欢迎页面布局 - 输入框粘底，欢迎文字居中 */
@media (max-width: 768px) {
  .welcome-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: calc(100vh - 120px); /* 减去头部和输入框高度 */
    padding-top: 2rem;
    padding-bottom: 0;
  }
  
  .input-container {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
    padding-bottom: max(1rem, var(--safe-area-inset-bottom));
    padding-left: max(1rem, var(--safe-area-inset-left));
    padding-right: max(1rem, var(--safe-area-inset-right));
    background: white;
  }
  
  .input-container::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 0;
    right: 0;
    height: 8px;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
    pointer-events: none;
  }
  
  .dark .input-container {
    background: rgb(31 41 55); /* gray-800 instead of gray-900 */
  }

  .dark .input-container::before {
    background: linear-gradient(to bottom, rgba(31, 41, 55, 0), rgba(31, 41, 55, 1)); /* gray-800 gradient */
  }
}

/* 移动端消息区域 */
@media (max-width: 768px) {
  .messages-container {
    padding-bottom: 0;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .messages-content {
    padding-left: max(1rem, calc(var(--safe-area-inset-left) + 0.25rem));
    padding-right: max(1rem, calc(var(--safe-area-inset-right) + 0.25rem));
    padding-bottom: 60px; /* 底部填充避免被输入框遮挡 */
  }
}

/* 移动端输入区域 - 粘底设计 */
@media (max-width: 768px) {
  .input-area {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
    padding-bottom: max(1rem, var(--safe-area-inset-bottom));
    padding-left: max(1rem, var(--safe-area-inset-left));
    padding-right: max(1rem, var(--safe-area-inset-right));
    background: white;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  
  .input-area::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 0;
    right: 0;
    height: 8px;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 1));
    pointer-events: none;
  }
  
  .dark .input-area {
    background: rgb(31 41 55 / 0.95); /* gray-800 instead of gray-900 */
  }
  
  .dark .input-area::before {
    background: linear-gradient(to bottom, rgba(31, 41, 55, 0), rgba(31, 41, 55, 0.95)); /* gray-800 gradient */
  }
}

/* 移动端消息气泡样式 */
@media (max-width: 768px) {
  .message-bubble {
    max-width: 70%; /* 与桌面端保持一致 */
    font-size: 15px; /* 接近桌面端体验 */
    line-height: 1.5; /* 优化行高 */
  }

  .message-bubble.user {
    margin-left: auto;
  }

  .message-bubble.assistant {
    margin-right: auto;
  }

  /* 移动端触摸高亮终极解决方案 - 禁用默认高亮，使用自定义方案 */

  /* 第一步：完全禁用 Webkit 默认触摸高亮 */
  * {
    -webkit-tap-highlight-color: transparent;
  }

  /* 第二步：确保所有可点击元素有正确的定位上下文 */
  button,
  [role="button"],
  [role="menuitem"] {
    position: relative;
    /* 创建新的层叠上下文 */
    isolation: isolate;
  }

  /* 第三步：使用伪元素创建精确的触摸高亮层 */
  button:active::after,
  [role="button"]:active::after,
  [role="menuitem"]:active::after {
    content: '';
    position: absolute;
    inset: 0;
    background-color: rgba(59, 130, 246, 0.1);
    border-radius: inherit; /* 继承父元素的圆角 */
    pointer-events: none;
    /* 使用 z-index 确保覆盖在内容之上 */
    z-index: 1;
  }

  /* 第四步：确保按钮内容在高亮层之上 */
  button > *,
  [role="button"] > *,
  [role="menuitem"] > * {
    position: relative;
    z-index: 2;
  }

  /* 特定元素保留原生高亮（性能更好） */
  input[type="range"],
  input[type="checkbox"],
  input[type="radio"],
  input[type="text"],
  input[type="number"],
  textarea,
  select {
    -webkit-tap-highlight-color: rgba(59, 130, 246, 0.15);
  }
  
  /* 代码块横向滚动和复制按钮 */
  .message-bubble pre {
    position: relative;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .message-bubble code {
    position: relative;
  }
  
  .message-bubble .copy-code-button {
    display: block !important;
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    font-size: 12px;
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    border: none;
    cursor: pointer;
    z-index: 10;
    min-width: 44px;
    min-height: 32px;
  }
  
  .dark .message-bubble .copy-code-button {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(4px);
  }
  
  /* 图片和表格自适应 */
  .message-bubble img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  .message-bubble table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
    border-radius: 8px;
  }
  
  .message-bubble thead {
    position: sticky;
    top: 0;
    background: white;
    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
    z-index: 1;
  }
  
  .dark .message-bubble thead {
    background: rgb(17 24 39);
  }
}

/* 最小触摸目标尺寸 - 44x44pt */
@media (max-width: 768px) {
  button, 
  .clickable,
  [role="button"] {
    min-width: 44px;
    min-height: 44px;
    touch-action: manipulation;
  }
}

/* 系统字体缩放支持 */
@media (max-width: 768px) {
  body {
    font-size: max(16px, 1rem);
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }
}

/* 触摸优化和手势支持 */
@media (max-width: 768px) {
  /* 防止触摸延迟 */
  a, button, input, select, textarea {
    touch-action: manipulation;
  }

  /* 滚动优化 */
  .scrollable,
  .messages-container {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: bounce;
    overscroll-behavior-x: contain;
  }

  /* 上滑隐藏输入附件栏效果 */
  .input-attachments {
    transform: translateY(0);
    transition: transform 0.3s ease-in-out;
  }

  .input-attachments.hidden {
    transform: translateY(100%);
  }
}

/* 回到底部按钮移动端样式 */
@media (max-width: 768px) {
  .scroll-to-bottom {
    position: fixed;
    bottom: calc(80px + max(1rem, var(--safe-area-inset-bottom)));
    right: max(1rem, var(--safe-area-inset-right));
    z-index: 20;
    width: 44px;
    height: 44px;
    border-radius: 22px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
}

/* PWA 支持 - 隐藏地址栏时的处理 */
@media (max-width: 768px) {
  @supports (display-mode: standalone) {
    .chat-layout {
      padding-top: var(--safe-area-inset-top);
    }
  }
}

/* 流光效果动画（用于标题生成加载状态） */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}
